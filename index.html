<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>وب‌اپ شیمی فیزیک ۱ — دانشگاه زنجان</title>

  <style>
    body { font-family: sans-serif; background:#f4f4f4; margin:0; padding:0; direction:rtl; }
    header { background:#283593; color:#fff; padding:20px; text-align:center; }
    header .logo { width:95px; height:auto; margin-bottom:10px; border-radius:10px; background:#fff; padding:6px; }
    header h1 { margin:0; font-size:24px; }
    header h2 { margin:6px 0 0; font-size:18px; font-weight:600; }
    header .author { margin-top:10px; font-size:13px; line-height:1.7; opacity:0.95; }

    .container {
      max-width: 980px;
      margin: 18px auto;
      background:#fff;
      padding:18px;
      border-radius:12px;
      box-shadow:0 0 10px rgba(0,0,0,0.1);
    }

    .tabs { display:flex; flex-wrap:wrap; gap:10px; margin-bottom:15px; }
    .tabs button {
      flex:1;
      min-width:150px;
      padding:10px;
      border:0;
      border-radius:20px;
      cursor:pointer;
      background:#e0e0e0;
      font-size:14px;
    }
    .tabs button.active { background:#283593; color:#fff; font-weight:700; }

    .tab-content { display:none; margin-top:8px; }
    .tab-content.active { display:block; }

    h2.section-title { margin:0 0 8px; font-size:18px; color:#283593; }
    p { font-size:14px; line-height:1.9; margin:8px 0; }

    .row { display:grid; grid-template-columns: repeat(auto-fit, minmax(210px, 1fr)); gap:10px; }
    label { display:block; margin-top:6px; font-size:13px; color:#111; }
    input {
      padding:8px;
      margin-top:5px;
      width:100%;
      box-sizing:border-box;
      border-radius:8px;
      border:1px solid #bbb;
    }
    .hint { font-size:12px; color:#555; margin-top:6px; }

    button.calc-btn {
      margin-top:14px;
      padding:9px 16px;
      border:0;
      border-radius:22px;
      background:#283593;
      color:#fff;
      cursor:pointer;
      font-size:14px;
    }
    button.calc-btn:hover { opacity:0.92; }

    .result-box {
      margin-top:14px;
      padding:12px;
      background:#f1f8e9;
      border-radius:10px;
      font-size:14px;
      border:1px solid #c5e1a5;
      line-height:2;
    }
    .warn { background:#fff3e0; border-color:#ffcc80; }

    table { width:100%; border-collapse:collapse; margin-top:10px; font-size:13px; }
    th, td { border:1px solid #ccc; padding:6px; text-align:center; }
    th { background:#eeeeee; }

    canvas { margin-top: 14px; max-width: 100%; }
  </style>

  <!-- Chart.js برای نمودار -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
  <header>
    <img
      src="https://upload.wikimedia.org/wikipedia/fa/5/5b/Logo_of_University_of_Zanjan.jpg"
      class="logo"
      alt="لوگوی دانشگاه زنجان"
    />
    <h1>دانشگاه زنجان</h1>
    <h2>دانشکده علوم</h2>
    <div class="author">
      تهیه شده توسط:<br>
      مهدی صادق‌زاده<br>
      آرین کبیری
    </div>
  </header>

  <div class="container">
    <div class="tabs">
      <button class="active" onclick="showTab('gas', this)">ماژول ۱: گاز ایده‌آل</button>
      <button onclick="showTab('firstlaw', this)">ماژول ۲: قانون اول</button>
      <button onclick="showTab('gibbs', this)">ماژول ۳: ΔG ،ΔH ،ΔS</button>
      <button onclick="showTab('equilibrium', this)">ماژول ۴: تعادل (K و ΔG°)</button>
    </div>

    <!-- ماژول 1 -->
    <div id="gas" class="tab-content active">
      <h2 class="section-title">ماژول ۱ – معادله گاز ایده‌آل</h2>

      <p>
        در این بخش از رابطه‌ی گاز ایده‌آل استفاده می‌کنیم:
        <b>PV = nRT</b>
      </p>

      <p>
        <b>واحدها (طبق همین واحدها وارد کنید):</b><br>
        • فشار <b>P</b> بر حسب <b>atm</b><br>
        • حجم <b>V</b> بر حسب <b>L</b><br>
        • مقدار ماده <b>n</b> بر حسب <b>mol</b><br>
        • دما <b>T</b> بر حسب <b>K</b><br>
        • ثابت گازها <b>R = 0.08206</b> (L·atm / mol·K)
      </p>

      <p class="hint">
        ✅ سه مقدار را وارد کنید و <b>یکی را خالی</b> بگذارید تا همان مقدار محاسبه شود.
      </p>

      <div class="row">
        <div><label>فشار P (atm)</label><input type="number" id="P" step="any" placeholder="مثال: 1"></div>
        <div><label>حجم V (L)</label><input type="number" id="V" step="any" placeholder="مثال: 22.4"></div>
        <div><label>مول n (mol)</label><input type="number" id="n" step="any" placeholder="مثال: 1"></div>
        <div><label>دما T (K)</label><input type="number" id="T" step="any" placeholder="مثال: 273.15"></div>
      </div>

      <button class="calc-btn" onclick="calculateGas()">محاسبه</button>
      <div id="gas-result" class="result-box"></div>
    </div>

    <!-- ماژول 2 -->
    <div id="firstlaw" class="tab-content">
      <h2 class="section-title">ماژول ۲ – قانون اول ترمودینامیک</h2>
      <p>
        رابطه اصلی: <b>ΔU = Q − W</b><br>
        • Q: گرمای داده‌شده به سیستم (اگر به سیستم داده شود مثبت)<br>
        • W: کار انجام‌شده توسط سیستم (اگر سیستم کار انجام دهد مثبت)
      </p>

      <div class="row">
        <div><label>Q (مثلاً J یا kJ)</label><input type="number" id="Q" step="any" placeholder="مثال: 100"></div>
        <div><label>W (مثلاً J یا kJ)</label><input type="number" id="W" step="any" placeholder="مثال: 20"></div>
      </div>

      <button class="calc-btn" onclick="calculateFirstLaw()">محاسبه ΔU</button>
      <div id="firstlaw-result" class="result-box"></div>
    </div>

    <!-- ماژول 3 -->
    <div id="gibbs" class="tab-content">
      <h2 class="section-title">ماژول ۳ – انرژی آزاد گیبس (ΔG) + نمودار ΔG–T</h2>
      <p>
        رابطه: <b>ΔG = ΔH − TΔS</b><br>
        در این بخش:<br>
        • ΔH بر حسب <b>kJ/mol</b><br>
        • ΔS بر حسب <b>J/mol·K</b><br>
        • T بر حسب <b>K</b><br>
        خروجی ΔG بر حسب <b>kJ/mol</b> نمایش داده می‌شود.
      </p>

      <div class="row">
        <div><label>دما T (K)</label><input type="number" id="T_gibbs" step="any" placeholder="مثال: 298"></div>
        <div><label>ΔH (kJ/mol)</label><input type="number" id="dH" step="any" placeholder="مثال: -100"></div>
        <div><label>ΔS (J/mol·K)</label><input type="number" id="dS" step="any" placeholder="مثال: -200"></div>
      </div>

      <button class="calc-btn" onclick="calculateGibbs()">محاسبه + جدول + نمودار</button>
      <div id="gibbs-result" class="result-box"></div>

      <div id="gibbs-table-container"></div>
      <canvas id="gibbs-chart"></canvas>
    </div>

    <!-- ماژول 4 -->
    <div id="equilibrium" class="tab-content">
      <h2 class="section-title">ماژول ۴ – تعادل شیمیایی (رابطه K و ΔG°)</h2>
      <p>
        رابطه: <b>ΔG° = −RT ln K</b><br>
        • R = 8.314 J/mol·K<br>
        • T بر حسب K و K بدون واحد است.<br>
        خروجی ΔG° بر حسب kJ/mol نمایش داده می‌شود.
      </p>

      <div class="row">
        <div><label>دما T (K)</label><input type="number" id="T_eq" step="any" placeholder="مثال: 298"></div>
        <div><label>ثابت تعادل K</label><input type="number" id="K_eq" step="any" placeholder="مثال: 10"></div>
      </div>

      <button class="calc-btn" onclick="calculateEquilibrium()">محاسبه ΔG°</button>
      <div id="equilibrium-result" class="result-box"></div>
    </div>
  </div>

  <script>
    // ---------- نمایش علمی (×10^n) ----------
    function sci(num, digits = 3) {
      if (!isFinite(num)) return "نامعتبر";
      if (num === 0) return "0";
      const exp = Math.floor(Math.log10(Math.abs(num)));
      const mantissa = num / Math.pow(10, exp);
      return `${mantissa.toFixed(digits)} × 10<sup>${exp}</sup>`;
    }

    // ---------- Tabs ----------
    function showTab(id, btn) {
      document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      document.querySelectorAll('.tabs button').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
    }

    function setWarn(el, isWarn) {
      el.classList.toggle('warn', !!isWarn);
    }

    // ---------- Module 1: Ideal Gas ----------
    function calculateGas() {
      const R = 0.08206; // L·atm / mol·K
      const res = document.getElementById('gas-result');

      let P = document.getElementById('P').value.trim();
      let V = document.getElementById('V').value.trim();
      let n = document.getElementById('n').value.trim();
      let T = document.getElementById('T').value.trim();

      const emptyCount = [P, V, n, T].filter(x => x === "").length;
      if (emptyCount !== 1) {
        res.innerHTML = "⚠️ دقیقاً <b>یکی</b> از مقادیر را خالی بگذارید و سه مقدار دیگر را وارد کنید.";
        setWarn(res, true);
        return;
      }

      P = (P === "") ? null : Number(P);
      V = (V === "") ? null : Number(V);
      n = (n === "") ? null : Number(n);
      T = (T === "") ? null : Number(T);

      const nums = [P, V, n, T].filter(x => x !== null);
      if (nums.some(x => !isFinite(x) || x <= 0)) {
        res.innerHTML = "⚠️ مقادیر واردشده باید <b>عدد مثبت و معتبر</b> باشند.";
        setWarn(res, true);
        return;
      }

      // solve missing
      if (P === null) P = (n * R * T) / V;
      else if (V === null) V = (n * R * T) / P;
      else if (n === null) n = (P * V) / (R * T);
      else if (T === null) T = (P * V) / (n * R);

      res.innerHTML =
        `<b>نتیجه (Scientific Notation):</b><br>
         P = ${sci(P)} atm<br>
         V = ${sci(V)} L<br>
         n = ${sci(n)} mol<br>
         T = ${sci(T)} K`;

      setWarn(res, false);
    }

    // ---------- Module 2: First Law ----------
    function calculateFirstLaw() {
      const res = document.getElementById('firstlaw-result');
      const Qs = document.getElementById('Q').value.trim();
      const Ws = document.getElementById('W').value.trim();

      if (Qs === "" || Ws === "") {
        res.innerHTML = "⚠️ لطفاً هر دو مقدار <b>Q</b> و <b>W</b> را وارد کنید.";
        setWarn(res, true);
        return;
      }

      const Q = Number(Qs);
      const W = Number(Ws);
      if (!isFinite(Q) || !isFinite(W)) {
        res.innerHTML = "⚠️ مقدارهای Q و W باید عدد معتبر باشند.";
        setWarn(res, true);
        return;
      }

      const dU = Q - W;

      let interpretation = "";
      if (dU > 0) interpretation = "ΔU > 0 → انرژی داخلی افزایش یافته است.";
      else if (dU < 0) interpretation = "ΔU < 0 → انرژی داخلی کاهش یافته است.";
      else interpretation = "ΔU = 0 → انرژی داخلی تغییر نکرده است.";

      res.innerHTML =
        `<b>خروجی:</b><br>
         ΔU = ${sci(dU)}<br>
         <span class="hint">${interpretation}</span>`;

      setWarn(res, false);
    }

    // ---------- Module 3: Gibbs + Chart ----------
    let gibbsChart = null;

    function calculateGibbs() {
      const res = document.getElementById('gibbs-result');
      const tableContainer = document.getElementById('gibbs-table-container');

      const Ts = document.getElementById('T_gibbs').value.trim();
      const dHs = document.getElementById('dH').value.trim();
      const dSs = document.getElementById('dS').value.trim();

      if (Ts === "" || dHs === "" || dSs === "") {
        res.innerHTML = "⚠️ لطفاً <b>T</b>، <b>ΔH</b> و <b>ΔS</b> را کامل وارد کنید.";
        setWarn(res, true);
        tableContainer.innerHTML = "";
        if (gibbsChart) { gibbsChart.destroy(); gibbsChart = null; }
        return;
      }

      const T = Number(Ts);
      const dH_kJ = Number(dHs);
      const dS_J = Number(dSs);

      if (!isFinite(T) || T <= 0 || !isFinite(dH_kJ) || !isFinite(dS_J)) {
        res.innerHTML = "⚠️ ورودی‌ها نامعتبرند. T باید مثبت باشد و بقیه عدد معتبر.";
        setWarn(res, true);
        tableContainer.innerHTML = "";
        if (gibbsChart) { gibbsChart.destroy(); gibbsChart = null; }
        return;
      }

      const dH_J = dH_kJ * 1000;
      const dG_kJ = (dH_J - T * dS_J) / 1000;

      let spontaneity = "";
      if (dG_kJ < 0) spontaneity = "ΔG < 0 → خودبه‌خودی";
      else if (dG_kJ > 0) spontaneity = "ΔG > 0 → غیرخودبه‌خودی";
      else spontaneity = "ΔG = 0 → تعادل";

      res.innerHTML =
        `<b>خروجی:</b><br>
         ΔG = ${sci(dG_kJ)} kJ/mol<br>
         <span class="hint">${spontaneity}</span>`;
      setWarn(res, false);

      // Build table + chart data around T
      const startT = Math.max(1, T - 50);
      const endT = T + 50;
      const step = 10;

      const labels = [];
      const chartVals = [];

      let tableHTML = "<table><thead><tr><th>T (K)</th><th>ΔG (kJ/mol)</th></tr></thead><tbody>";
      for (let temp = startT; temp <= endT; temp += step) {
        const dG_temp = (dH_J - temp * dS_J) / 1000;
        labels.push(temp);
        chartVals.push(dG_temp);
        tableHTML += `<tr><td>${temp}</td><td>${sci(dG_temp)}</td></tr>`;
      }
      tableHTML += "</tbody></table>";
      tableContainer.innerHTML = tableHTML;

      const ctx = document.getElementById('gibbs-chart').getContext('2d');
      if (gibbsChart) gibbsChart.destroy();

      gibbsChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'ΔG (kJ/mol)',
            data: chartVals,
            tension: 0.25
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: true }
          },
          scales: {
            x: { title: { display: true, text: 'T (K)' } },
            y: { title: { display: true, text: 'ΔG (kJ/mol)' } }
          }
        }
      });
    }

    // ---------- Module 4: Equilibrium ----------
    function calculateEquilibrium() {
      const res = document.getElementById('equilibrium-result');
      const Ts = document.getElementById('T_eq').value.trim();
      const Ks = document.getElementById('K_eq').value.trim();

      if (Ts === "" || Ks === "") {
        res.innerHTML = "⚠️ لطفاً <b>T</b> و <b>K</b> را وارد کنید.";
        setWarn(res, true);
        return;
      }

      const T = Number(Ts);
      const K = Number(Ks);
      if (!isFinite(T) || T <= 0 || !isFinite(K) || K <= 0) {
        res.innerHTML = "⚠️ T باید مثبت باشد و K هم باید عدد مثبت و معتبر باشد.";
        setWarn(res, true);
        return;
      }

      const R = 8.314; // J/mol·K
      const dG_kJ = (-(R * T * Math.log(K))) / 1000;

      let direction = "";
      if (dG_kJ < 0) direction = "ΔG° < 0 → تعادل به سمت فرآورده‌ها متمایل است.";
      else if (dG_kJ > 0) direction = "ΔG° > 0 → تعادل به سمت واکنش‌دهنده‌ها متمایل است.";
      else direction = "ΔG° = 0 → حالت تعادل.";

      res.innerHTML =
        `<b>خروجی:</b><br>
         ΔG° = ${sci(dG_kJ)} kJ/mol<br>
         <span class="hint">${direction}</span>`;
      setWarn(res, false);
    }
  </script>
</body>
</html>
